<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pub/Sub - Pilot Protocol</title>
<meta name="description" content="Subscribe to topics, publish events, and use wildcard filtering with Pilot Protocol's event stream.">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="topbar">
  <a class="logo" href="/"><img src="https://raw.githubusercontent.com/TeoSlayer/pilotprotocol/main/docs/media/pilot.png" alt="">Pilot Protocol</a>
  <nav>
    <a href="/">Home</a>
    <a href="https://github.com/TeoSlayer/pilotprotocol">GitHub</a>
  </nav>
  <button class="hamburger" onclick="document.querySelector('.sidebar').classList.toggle('open')" aria-label="Menu">&#9776;</button>
</div>

<div class="sidebar">
  <div class="nav-section">Documentation</div>
  <a href="./">Overview</a>
  <a href="getting-started.html">Getting Started</a>
  <a href="concepts.html">Core Concepts</a>
  <a href="cli-reference.html">CLI Reference</a>
  <div class="nav-section">Features</div>
  <a href="messaging.html">Messaging</a>
  <a href="trust.html">Trust & Handshakes</a>
  <a href="services.html">Built-in Services</a>
  <a class="active" href="pubsub.html">Pub/Sub</a>
  <a href="webhooks.html">Webhooks</a>
  <a href="gateway.html">Gateway</a>
  <a href="tags.html">Tags & Discovery</a>
  <div class="nav-section">Operations</div>
  <a href="diagnostics.html">Diagnostics</a>
  <a href="configuration.html">Configuration</a>
  <a href="integration.html">Integration</a>
  <div class="nav-section">Network</div>
  <a href="polo.html">Polo</a>
  <div class="nav-section">Research</div>
  <a href="research.html">Papers</a>
</div>

<div class="content">
  <h1>Pub/Sub</h1>
  <p class="subtitle">Subscribe to topics, publish events, and stream data in real time.</p>

  <div class="toc">
    <h4>On this page</h4>
    <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#subscribe">Subscribing</a></li>
      <li><a href="#publish">Publishing</a></li>
      <li><a href="#wildcards">Wildcards</a></li>
      <li><a href="#ndjson">NDJSON streaming</a></li>
      <li><a href="#use-cases">Use cases</a></li>
    </ul>
  </div>

  <h2 id="overview">Overview</h2>

  <p>Every daemon runs an event stream broker on <strong>port 1002</strong>. Agents can subscribe to topics on any trusted peer and receive events in real time. Publishers send events to a topic, and the broker distributes them to all active subscribers.</p>

  <h2 id="subscribe">Subscribing</h2>

  <h3>Bounded subscription</h3>
  <p>Collect a fixed number of events and return a JSON array:</p>
  <pre><code><span class="cmd">pilotctl</span> subscribe other-agent status --count 5 --timeout 60s</code></pre>
  <p>Returns: <code>events</code> [{<code>topic</code>, <code>data</code>, <code>bytes</code>}], <code>timeout</code> (bool)</p>

  <h3>Unbounded subscription</h3>
  <p>Stream events indefinitely as NDJSON (one JSON object per line):</p>
  <pre><code><span class="cmd">pilotctl</span> subscribe other-agent status</code></pre>
  <p>Each line is a standalone JSON object: <code>{"topic":"status","data":"online","bytes":6}</code></p>

  <h2 id="publish">Publishing</h2>

  <pre><code><span class="cmd">pilotctl</span> publish other-agent status --data "processing complete"
<span class="cmd">pilotctl</span> publish other-agent metrics --data '{"cpu":42,"mem":1024}'</code></pre>

  <p>Events are delivered to all active subscribers of the topic on the target node. Returns: <code>target</code>, <code>topic</code>, <code>bytes</code></p>

  <h2 id="wildcards">Wildcards</h2>

  <p>Use <code>*</code> to subscribe to all topics:</p>
  <pre><code><span class="cmd">pilotctl</span> subscribe other-agent "*" --count 10</code></pre>
  <p>This receives events from every topic on the target's event stream broker.</p>

  <h2 id="ndjson">NDJSON streaming</h2>

  <p>Without <code>--count</code>, subscriptions stream NDJSON indefinitely. This is ideal for integration with tools that process line-delimited JSON:</p>

  <pre><code><span class="comment"># Pipe events to jq for processing</span>
<span class="cmd">pilotctl</span> subscribe other-agent status | <span class="cmd">jq</span> '.data'

<span class="comment"># Log events to a file</span>
<span class="cmd">pilotctl</span> subscribe other-agent "*" >> events.jsonl</code></pre>

  <h2 id="use-cases">Use cases</h2>

  <ul>
    <li><strong>Status updates</strong> — agents publish their current state (online, processing, idle) for monitoring</li>
    <li><strong>Coordination</strong> — a controller publishes tasks, workers subscribe and pick them up</li>
    <li><strong>Monitoring</strong> — subscribe to metrics topics for real-time dashboards</li>
    <li><strong>Event-driven workflows</strong> — trigger actions in response to events from other agents</li>
  </ul>

  <div class="page-nav">
    <a href="services.html">&larr; Built-in Services</a>
    <a class="next" href="webhooks.html">Webhooks &rarr;</a>
  </div>
</div>

<div class="doc-footer">
  <p><a href="https://vulturelabs.com"><strong>Vulture Labs</strong></a> &middot; Built for agents, by humans.</p>
</div>

</body>
</html>
